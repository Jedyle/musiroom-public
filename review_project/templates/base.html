{% load staticfiles %}

{% load i18n %}

{% load bootstrap_tags %}
{% load postman_tags %}
{% load core_tags %}

{% load notifications_tags %}

{% notifications_unread as notif_unread_count %}
{% postman_unread as message_unread_count %}

<!DOCTYPE html>
<html lang="en">
    <head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="La Musithèque">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="google-site-verification" content="c0eu5cthqqDx8Ir7CF2pysANz8kGfzyHz5znn9ddeJE" />
	<meta property="og:image" content="{% static 'images/icon.jpg' %}" />

	<title>{% if user.is_authenticated %}

	    {% if notif_unread_count > 0 or message_unread_count > 0 %}
	    ({{ notif_unread_count|add:message_unread_count}})
	    {% endif %}
	    {% endif %}


	    {% block title %}Home
	    {% endblock %} - La Musithèque, critiques de musique faites par vous !
	</title>

	<meta name="description" content="Critiques d'albums et communauté de passionnés de musique" />

	<link rel="shortcut icon" href="{% static 'images/favicon.ico' %}">

	<!-- Required Stylesheets -->
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/fontawesome-all.css' %}">
	<link rel="stylesheet" href="{% static 'css/w3.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/style.css' %}">

	<link rel="stylesheet" href="{% static 'css/css-loader.css' %}">
	<link rel="stylesheet" href="{% static 'star-ratings/css/star-ratings.css' %}">

	<link rel="stylesheet" href="{% static 'css/modal.css' %}">

	<link href="{% static 'css/trumbowyg.min.css' %}" rel="stylesheet">

	
	<!-- Required scripts -->

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122682208-1"></script>
	<script>
	 window.dataLayer = window.dataLayer || [];
	 function gtag(){dataLayer.push(arguments);}
	 gtag('js', new Date());

	 gtag('config', 'UA-122682208-1');
	</script>
	

	{% block extrahead %}
	{% endblock %}

    </head>

    <body>
	<!-- Our application root element -->
	
	<header>

	    <nav class="navbar fixed-top navbar-expand-lg navbar-dark color-sanguine">
		<a class="navbar-brand" href="/">La Musithèque</a>

		{% if user.is_authenticated %}
		<div class="navbar-header navbar-right float-right">
		    <ul class="navbar-nav navbar-right ml-auto d-block d-lg-none">
			<li class="nav-item {% active_url 'notifications' %} mr-2 mr-md-3 ml-1 ml-sm-2 ml-md-3">
			    {% if notif_unread_count > 0 %}
			    <a title="Notifications" class="nav-link" href="{% url 'notifications' %}"><i class="notif-badge far fa-bell fa-lg"  data-badge="{{notif_unread_count}}"></i></a>
			    {% else %}
			    <a title="Notifications" class="nav-link" href="{% url 'notifications' %}"><i class="far fa-bell fa-lg"></i></a>
			    {% endif %}
			</li>
			<li class="nav-item dropdown mr-2 mr-md-3 mr-sm-2 ml-1 ml-sm-2 ml-md-3">
			    <a href="#" class="nav-link dropdown-toggle mt-0 mb-0 pt-0 pb-0" id="navbarDropdownColl" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<span {% if message_unread_count > 0 %}class="notif-badge" data-badge="{{message_unread_count}}"{% endif %}>
				    <div class="profile-thumb" >
					<img title="{{ user.username }}" src="{{ user.account.get_avatar }}">
					
				    </div>
				</span>
			    </a>
			    <div id="navbarDropdownCollMenu" class="dropdown-menu dropdown-menu-right no-collapse" aria-labelledby="navbarDropdownColl">
				<a class="dropdown-item" href="{% url 'profile' user.username %}">Profil</a>
				<a class="dropdown-item" href="{% url 'postman:inbox' %}">Messagerie {% if message_unread_count > 0 %}({{message_unread_count}}){% endif %}</a>
				<a class="dropdown-item" href="{% url 'edit_profile' %}">Modifier mes infos</a>
				<a class="dropdown-item" href="{% url 'logout' %}">Déconnexion</a>
			    </div>
			</li>
			<button class="navbar-toggler ml-1 ml-sm-2 ml-md-3" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			    <span class="navbar-toggler-icon"></span>
			</button>
		    </ul>
		</div>
		{% else %}

		<div class="navbar-header navbar-right float-right">
		    <ul class="navbar-nav navbar-right ml-auto d-block d-lg-none">
			<li class="nav-item dropdown mr-2 mr-md-3 mr-sm-2 ml-1 ml-sm-2 ml-md-3">
			    <a href="#" class="nav-link dropdown-toggle mt-0 mb-0 pt-0 pb-0" id="navbarDropdownColl" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<div class="profile-thumb">
				    <img title="Mon compte" src="{% static 'account/images/profile.png' %}">
				</div>
			    </a>
			    <div id="navbarDropdownCollMenu" class="dropdown-menu dropdown-menu-right no-collapse" aria-labelledby="navbarDropdownColl">
				<a class="dropdown-item" href="{% url 'login' %}?next={{request.path}}">Connexion</a>
				<a class="dropdown-item" href="{% url 'register' %}">Inscription</a>
			    </div>
			</li>
			<button class="navbar-toggler ml-1 ml-sm-2 ml-md-3" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			    <span class="navbar-toggler-icon"></span>
			</button>
		    </ul>
		</div>

		{% endif %}


		<div class="collapse navbar-collapse" id="navbarSupportedContent">
		    <ul class="navbar-nav col-xl-3 col-lg-3">
			{% url 'albums:browse_album' as album_url %}
			<!-- <li class="nav-item {% active_url 'albums:browse_albums' %}">
			     <a class="nav-link" href="{% url 'albums:browse_albums' %}">Albums</a>
			     </li> -->
			<li class="nav-item {% active_url 'albums:top_album' %}">
			    <a class="nav-link" href="{% url 'albums:top_album_get' %}">Tops</a>
			</li>
			<li class="nav-item {% active_url 'albums:genres' %}">
			    <a class="nav-link" href="{% url 'albums:genres' %}">Genres</a>
			</li>
		    </ul>
		    <ul class="navbar-nav col-xl-3 offset-xl-4 offset-lg-3 col-lg-3">
			<form class="form-inline" method="get" action="{% url 'albums:search' %}" role="search">

				{% url 'albums:search' as nav_search_url %}
				<div class="input-group row no-gutters">
				    <span class="input-group-btn col-8">
					<input type="text" class="form-control" name="query" placeholder="Rechercher..." value="{% block search_value %}{% endblock %}">
				    </span>
				    <span class="input-group-btn col-4">
					<select class="form-control" name="type" style="height : 100%">
					    <option value="album" {% block album_search_selected %}{% endblock %}>Album</option>
					    <option value="artiste" {% block artist_search_selected %}{% endblock %}>Artiste</option>
					    <option value="liste" {% block list_search_selected %}{% endblock %}>Liste</option>
					    <option value="compte" {% block account_search_selected %}{% endblock %}>Utilisateur</option>
					    
					</select>
				    </span>
				    <input type="submit" 
					   style="position: absolute; left: -9999px; width: 1px; height: 1px;"
					   tabindex="-1" />
				</div>		
			    
			</form>
		    </ul>
		    <ul class="navbar-nav ml-auto">			
			
			{% if user.is_authenticated %}
			<li class="nav-item {% active_url 'notifications' %} d-none d-lg-block">
			    {% if notif_unread_count > 0 %}
			    <a title="Notifications" class="nav-link" href="{% url 'notifications' %}"><i class="notif-badge far fa-bell fa-lg"  data-badge="{{notif_unread_count}}"></i></a>
			    {% else %}
			    <a title="Notifications" class="nav-link" href="{% url 'notifications' %}"><i class="far fa-bell fa-lg"></i></a>
			    {% endif %}
			    
			</li>
			{% endif %}
			<li class="nav-item dropdown d-none d-lg-block"  {% if message_unread_count > 0 %}data-badge="{{message_unread_count}}"{% endif %}>
			    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				{% if user.is_authenticated %}<span {% if message_unread_count > 0 %}class="notif-badge" data-badge="{{message_unread_count}}"{% endif %}>{{ user.username }}</span>{% else %}Compte{% endif %}
			    </a>
			    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
				{% if user.is_authenticated %}
				<a class="dropdown-item" href="{% url 'profile' user.username %}">Profil</a>
				<a class="dropdown-item" href="{% url 'postman:inbox' %}">Messagerie {% if message_unread_count > 0 %}({{message_unread_count}}){% endif %}</a>
				<a class="dropdown-item" href="{% url 'edit_profile' %}">Modifier mes infos</a>
				<a class="dropdown-item" href="{% url 'logout' %}">Déconnexion</a>
				{% else %}
				<a class="dropdown-item" href="{% url 'login' %}?next={{request.path}}">Connexion</a>
				<a class="dropdown-item" href="{% url 'register' %}">Inscription</a>
				{% endif %}
			    </div>
			</li>
		    </ul>
		</div>
	    </nav>

	</header>
	
	<main role="main" class="container-fluid">
	    {% block body_title %}
	    {% endblock %}
	    
	    <div class="row">
		{% block postman_menu %}
		{% endblock %}	    
		
		{% block content %}		    
		{% endblock content %}
	    </div>
	    
	</main>
	
	<br><br>
	
	<footer class="footer font-small bg-light">

	    <!-- Footer Links -->
	    <div class="container text-center text-md-left">
		<!-- Grid row -->
		<div class="row d-flex align-items-center">

		    <!-- Grid column -->
		    <div class="col-12">

			<!--Copyright-->
			<p class="text-center text-md-left">© 2018 <a href="mailto:contact.lamusitheque@gmail.com">Jedyle</a> -  <a href="{% url 'feedback:feedback' %}">Feedback</a></p>

		    </div>

		</div>
		<!-- Grid row -->

	    </div>
	    <!-- Footer Links -->

	</footer>
	<!-- Footer -->


	<script type="text/javascript" src="{% static 'js/bootstrap-native-v4.min.js' %}"></script>

	<script src="{% static 'lists/js/add_album.js' %}"></script>

	<script>

	 window.addEventListener('load', function(){
	     var allimages= document.getElementsByTagName('img');
	     for (var i=0; i<allimages.length; i++) {
		 if (allimages[i].getAttribute('data-src')) {
		     allimages[i].setAttribute('src', allimages[i].getAttribute('data-src'));
		 }
	     }
	     var event = new Event('imgLoaded');
	     window.dispatchEvent(event);
	 }, false)
	 
	 var account_menu = document.getElementById('navbarDropdownColl')
	 account_menu.addEventListener('click', function(event){
	     event.preventDefault();
	     document.getElementById('navbarDropdownCollMenu').classList.toggle('show');
	 });

	 document.getElementById('navbarDropdownColl').addEventListener('blur', function(event){
	     document.getElementById('navbarDropdownCollMenu').classList.toggle('show');  
	 })

	</script>
	
	{% block scripts %}

	{% endblock %}

    </body>
</html>
